<div class="max-w-7xl mx-auto p-8">
  <div class="flex justify-between items-start mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">Welcome back, {{ authService.currentUser()?.username }}!</h1>
      <p class="text-gray-500">
        Manage your movie collection with ease. Add, edit, or delete movies and keep your list up to
        date!
      </p>
    </div>
    <button
      class="bg-gray-100 flex items-center gap-2 hover:bg-gray-200 cursor-pointer text-gray-700 font-medium px-4 py-2 rounded-lg transition-colors"
      (click)="authService.logout()"
      title="Logout"
    >
      <lucide-icon [img]="LogOutIcon" [size]="18" />
      Logout
    </button>
  </div>
  <app-dashboard-metrics [stats]="stats()"/>
  <div class="flex justify-between mb-5 gap-8">
    <div class="max-w-96 w-full">
      <app-form-input
        [label]="''"
        [id]="'search'"
        [control]="searchControl"
        [placeholder]="'Search movie'"
        [icon]="SearchIcon"
      />
    </div>
    <button
      class="bg-cyan-600 flex items-center gap-2 hover:bg-cyan-500 cursor-pointer text-white font-medium px-4 py-2 rounded-lg transition-colors"
      (click)="createMovie()"
    >
      <span><lucide-icon [img]="PlusIcon" [size]="18" /></span>
      New Movie
    </button>
  </div>

  @if (loading()) {
    <div class="text-center py-12 text-xl text-gray-600">Loading movies...</div>
  }

  @if (error()) {
    <div class="bg-red-50 text-red-600 text-center py-4 px-6 rounded-lg mb-6">{{ error() }}</div>
  }

  @if (!loading() && movies().length === 0) {
    <div class="text-center py-12 text-xl text-gray-600">
      <p>No movies found. Start by adding your first movie!</p>
    </div>
  }

  @if (!loading() && movies().length > 0) {
    <table class="w-full bg-white overflow-clip border rounded-lg border-gray-300">
      <tr>
        <th class="py-2 font-medium text-gray-500 text-sm text-left px-6">Title</th>
        <th class="py-2 font-medium text-gray-500 text-sm text-left px-6">Director</th>
        <th class="py-2 font-medium text-gray-500 text-sm text-left px-6">Genre</th>
        <th class="py-2 font-medium text-gray-500 text-sm text-left px-6">Release Year</th>
        <th class="py-2 font-medium text-gray-500 text-sm text-left px-6">Rating</th>
        <th></th>
      </tr>
      @for (movie of movies(); track movie.id) {
        <tr class="odd:bg-white even:bg-gray-50">
          <td class="py-3 font-medium text-gray-900 text-base text-left px-6">
            <span class="font-normal text-gray-300">#{{ movie.id }}</span> {{ movie.title }}
          </td>
          <td class="py-3 font-normal text-gray-900 text-base text-left px-6">
            {{ movie.director }}
          </td>
          <td class="py-3 font-normal text-gray-800 text-base text-left px-6">{{ movie.genre }}</td>
          <td class="py-3 font-normal text-gray-800 text-base text-left px-6">
            {{ movie.releaseYear }}
          </td>
          <td class="py-3 font-medium text-cyan-600 text-base text-left px-6">
            {{ movie.rating }}
          </td>
          <td class="py-3 font-normal text-gray-800 text-base text-left px-6">
            <div class="flex gap-2">
              <button
                class="text-gray-400 p-2 rounded cursor-pointer hover:bg-gray-100 duration-300"
                (click)="editMovie(movie.id)"
                title="Edit movie"
              >
                <lucide-icon [img]="PencilIcon" [size]="18" />
              </button>
              <button
                class="text-gray-400 p-2 rounded cursor-pointer hover:bg-gray-100 duration-300"
                (click)="deleteMovie({ id: movie.id, title: movie.title })"
                title="Delete movie"
              >
                <lucide-icon [img]="TrashIcon" [size]="18" />
              </button>
            </div>
          </td>
        </tr>
      }
    </table>
  }
</div>

<!-- Movie Modal -->
<app-movie-modal
  [isOpen]="modalOpen()"
  [movieId]="editingMovieId()"
  [movieData]="editingMovieData()"
  [loading]="modalLoading()"
  (close)="closeModal()"
  (save)="saveMovie($event)"
/>

<!-- Delete Confirmation Modal -->
<app-confirm-modal
  [isOpen]="deleteConfirmOpen()"
  [title]="'Delete Movie'"
  [message]="
    'Are you sure you want to delete &quot;' +
    (movieToDelete()?.title || '') +
    '&quot;? This action cannot be undone.'
  "
  [confirmText]="'Delete'"
  [cancelText]="'Cancel'"
  [confirmButtonClass]="'bg-red-500 hover:bg-red-600'"
  [loading]="deleteLoading()"
  (confirm)="confirmDelete()"
  (cancel)="cancelDelete()"
/>
